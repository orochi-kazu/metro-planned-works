(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,,,,,,,,,,,,function(e,t,n){},,function(e,t,n){e.exports=n.p+"static/media/logo.5901d734.svg"},,function(e,t,n){e.exports=n(33)},,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},,function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(14),i=n.n(s),l=(n(23),n(1)),c=n(5),o=n(6),u=n(9),d=n(7),f=n(3),h=n(10),m=n(8),p=(n(24),function(e){var t=e.initial,n=e.placeholder,a=e.onChange,s=e.extraClass;return r.a.createElement("input",{className:"search ".concat(s," bordered radius-m"),name:n.toLowerCase(),type:"text",value:t,placeholder:n,onChange:a})}),v=function(){return r.a.createElement("input",{className:"search end bordered radius-m",type:"submit",value:"Search"})},b=function(e){function t(e){var n;Object(c.a)(this,t);var a=(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).props,r=a.src,s=a.dst;return n.state={src:r,dst:s},n.handleChange=n.handleChange.bind(Object(f.a)(n)),n.handleSubmit=n.handleSubmit.bind(Object(f.a)(n)),n}return Object(h.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.src,n=e.dst;this.setState({src:t,dst:n})}},{key:"handleChange",value:function(e){var t=this;return function(n){t.setState(Object(m.a)({},e,n.target.value))}}},{key:"handleSubmit",value:function(e){e.preventDefault();var t=this.state,n=t.src,a=t.dst;window.history.pushState(null,"","?src=".concat(n,"&dst=").concat(a)),this.props.search(n,a)}},{key:"render",value:function(){return r.a.createElement("form",{className:"search",onSubmit:this.handleSubmit},r.a.createElement(p,{initial:this.state.src,placeholder:"Origin",onChange:this.handleChange("src"),extraClass:"start"}),r.a.createElement(p,{initial:this.state.dst,placeholder:"Destination",onChange:this.handleChange("dst"),extraClass:"middle"}),r.a.createElement(v,null))}}]),t}(a.Component),E=(n(13),function(e){var t=e.search,n=e.src,a=e.dst;return r.a.createElement("header",null,r.a.createElement("span",{className:"title"},r.a.createElement("span",{className:"icon"},"\u26a0")," Legible Works"),r.a.createElement(b,{search:t,src:n,dst:a}))}),g=(n(25),function(e){var t=e.count,n=e.type;return r.a.createElement("span",{className:"alert ".concat(n," bordered radius-m")},"number"===typeof t?t:"?")}),y=function(e){var t=e.alerts;return r.a.createElement("div",null,r.a.createElement(g,{count:t.total,type:"total"})," alert details (",r.a.createElement(g,{count:t.ingested,type:"ingested"})," ingested,"," ",r.a.createElement(g,{count:t.pending,type:"pending"})," pending)")},S=(n(26),function(e){var t=e.lastSync,n=e.lastUpdate;return r.a.createElement("div",null,"Alerts Synced: ",r.a.createElement("span",{className:"updated"},t),", Last updated: ",r.a.createElement("span",{className:"updated"},n))}),k=(n(27),function(){return r.a.createElement("div",null,"Licensed under AGPL 3+. Source at ",r.a.createElement("a",{href:"https://github.com/orochi-kazu/metro-planned-works",target:"_blank",rel:"noopener"},"GitHub"))}),j=function(e){var t=e.alerts,n=e.lastSync,a=e.lastUpdate;return r.a.createElement("footer",null,r.a.createElement(y,{alerts:t}),r.a.createElement(S,{lastSync:n,lastUpdate:a}),r.a.createElement(k,null))},O=n(15),w=n.n(O),C=(n(28),function(){return r.a.createElement("div",{className:"empty-content"},r.a.createElement("img",{className:"logo",src:w.a,alt:"App logo: a caution sign"}))}),L=(n(29),function(){return r.a.createElement("div",{className:"outage uningested bordered radius-m"},"Pending")}),A=function(e){var t=e.area,n=e.from,a=e.to;return r.a.createElement("div",{className:"outage bordered radius-m"},r.a.createElement("div",{className:"outage-desc"},'"',t.desc,'"'),r.a.createElement("div",null,"Starts: ",n.iso),r.a.createElement("div",null,"Ends: ",a.iso))},N=function(e){e.id;var t=e.title,n=e.outages,a=e.link;return r.a.createElement("div",{className:"detail bordered radius-m"},r.a.createElement("div",{className:"alert-title"},r.a.createElement("span",null,t,r.a.createElement("span",{className:"nowrap"}," (",r.a.createElement("a",{href:a,target:"_blank",rel:"noopener"},"Metro"),")"))),r.a.createElement("div",null,n?n.map(function(e,t){return r.a.createElement(A,Object.assign({},e,{key:t}))}):r.a.createElement(L,null)))},_=(n(30),function(e){var t=e.id,n=(e.alerts,e.line),a=e.plannedWorks,s=e.getAlertDetails;if(!a)return null;var i=function(e){return function(t,n){var a=e(t);return a?r.a.createElement(N,Object.assign({},a,{title:n,key:t})):null}}(s);return r.a.createElement("div",{className:"alert-summary bordered radius-m"},r.a.createElement("div",{className:"alert-summary-title"},r.a.createElement("span",{className:"alert-summary-title"},n||"Unnamed line"),n?"":r.a.createElement("span",null,"\xa0(",t,")")),a.map(function(e){return i(e.id,e.title)}))}),D=function(e){var t=e.alerts,n=e.getAlertDetails;return t.map(function(e){return r.a.createElement(_,Object.assign({},e,{getAlertDetails:n,key:e.id}))})},U=function(e){var t=e.cityLoop,n=e.lines,a=e.stations,s=e.error;return s?r.a.createElement("div",{className:"results-intro"},r.a.createElement("div",null,"Something went wrong: ",s)):r.a.createElement("div",{className:"results-intro"},r.a.createElement("div",null,"City Loop? ",t?"Yes":"No"),r.a.createElement("div",null,"Lines: ",(n||[]).join(", ")),r.a.createElement("div",null,"Stations: ",(a||[]).join(", ")))},R=(n(31),n(2)),x=n.n(R),P=n(4),W=function(e){return{fetch:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){return fetch(e).then(function(e){return e.json()})})}},I=[],T={alerts:{},fetchDate:"",releaseDate:""},B={},F=function(){var e=Object.keys(T.alerts),t=e.length,n=e.map(function(e){return T.alerts[e]}).filter(function(e){return e.outages}).length;return{total:t,ingested:n,pending:t-n}},M=function(){var e=Object(P.a)(x.a.mark(function e(t){var n;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.metroVarsClient,e.next=3,n.fetch();case 3:return B=e.sent,e.abrupt("return",{save:function(e){var t=e.healthboardAlerts,n=e.alertDetails;I=t,T=n},alerts:function(){return I},alertCounts:function(){return F()},alertDetails:function(e){return T.alerts[e]},lastSync:function(){return T.fetchDate},lastUpdated:function(){return T.releaseDate},stationsByLineName:function(){return B.network||{}},cityLoopStations:function(){return B.cityLoopStations}});case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),Q=n(11),z=function(e){return Object.keys(e).map(function(t){return Object(Q.a)({},e[t],{id:t})})},V=function(e){return{id:e.id,line:e.line_name,plannedWorks:e.planned_works_list}},H=function(e,t){return e.filter(function(e){return(t||[]).includes(e.line)})},G=function(e){return Array.from(new Set(e.flatMap(function(e){return e.plannedWorks.flatMap(function(e){return e.id})})))},J=function(e,t,n){var a=H(e,t);return function(e,t){return e.map(function(e){return Object(Q.a)({},e,{plannedWorks:e.plannedWorks.filter(function(e){return t.includes(e.id)})})}).filter(function(e){return e.plannedWorks.length>0})}(a,G(a))},Y=function(){var e=Object(P.a)(x.a.mark(function e(t){var n,a,r,s,i,c,o,u,d;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.healthboardClient,a=t.detailsClient,r=t.store,e.next=3,Promise.all([n.fetch(),a.fetch()]);case 3:return s=e.sent,i=Object(l.a)(s,2),c=i[0],o=i[1],u=z(c).map(V),d=Object(Q.a)({},o,{alerts:(f=o.alerts,Object.fromEntries(f.map(function(e){return[e.id,e]})))}),r.save({healthboardAlerts:u,alertDetails:d}),e.abrupt("return",{alerts:function(){return r.alerts()},alertCounts:function(){return r.alertCounts()},alertDetails:function(e){return r.alertDetails(e)},lastUpdated:function(){return r.lastUpdated()},lastSync:function(){return r.lastSync()},alertsForLinesStations:function(e,t){return J(r.alerts(),e)}});case 11:case"end":return e.stop()}var f},e)}));return function(t){return e.apply(this,arguments)}}(),$=n(16),q=function(e,t){return e.reduce(function(e,n){return e||t.includes(n)},!1)},K=function(e,t){return e.length===t.length&&function(e,t){return e.map(function(e,n){return[e,t[n]]})}(e,t).reduce(function(e,t){var n=Object(l.a)(t,2),a=n[0],r=n[1];return e&&a===r},!0)},X=function(e,t,n){var a=function(e){return{lines:e}},r=function(e){return{error:e}};if(t===n)return r("no need to catch the train");var s=ee(e,t),i=ee(e,n);if(0===s.length&&0===i.length)return r("couldn't find either station");if(0===s.length)return r("couldn't find station \"".concat(t,'"'));if(0===i.length)return r("couldn't find station \"".concat(n,'"'));if(K(s,i))return a(s);if(!q(s,i))return r("these aren't on the same line");var c=s.length<i.length?[s,i]:[i,s],o=Object(l.a)(c,2),u=o[0];return function(e,t){var n=e.length<t.length,a=K(e,e.filter(function(e){return t.includes(e)}));return n&&a}(u,o[1])?a(u):r("oh no")},Z=function(e,t,n){return e.includes(t)||e.includes(n)},ee=function(e,t){return Object.entries(e).reduce(function(e,n){var a=Object(l.a)(n,2),r=a[0];return a[1].includes(t)?[].concat(Object($.a)(e),[r]):e},[])},te=function(e,t,n,a){var r=e[t],s=r.indexOf(n),i=r.indexOf(a);if(s<0||i<0)return[];var c=s<i?[s,i]:[i,s],o=Object(l.a)(c,2),u=o[0],d=o[1],f=r.slice(u,d+1);return f[0]===n?f:f.reverse()},ne=function(e){var t=e.store;return{search:function(e,n){var a=Z(t.cityLoopStations(),e,n),r=X(t.stationsByLineName(),e,n);if(r.error)return r;var s=r.lines,i=s[0];return{cityLoop:a,lines:s,stations:i?te(t.stationsByLineName(),i,e,n):[]}}}},ae=function(e){return Object({NODE_ENV:"production",PUBLIC_URL:"/metro-planned-works",REACT_APP_ALERT_DETAILS_URL:"https://orochi-kazu.github.io/metro-planned-works/alert_details.json",REACT_APP_HEALTHBOARD_ALERTS_URL:"https://orochi-kazu.github.io/metro-planned-works/healthboard_alerts.json",REACT_APP_METRO_VARIABLES_URL:"https://orochi-kazu.github.io/metro-planned-works/metro_variables.json"})["REACT_APP_".concat(e.toUpperCase(),"_URL")]},re=ae("healthboard_alerts"),se=ae("alert_details"),ie=ae("metro_variables"),le=W(re),ce=W(se),oe=W(ie),ue=function(){var e=Object(P.a)(x.a.mark(function e(){var t,n,a;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M({metroVarsClient:oe});case 2:return t=e.sent,e.next=5,Y({healthboardClient:le,detailsClient:ce,store:t});case 5:return n=e.sent,a=ne({store:t}),e.abrupt("return",{domain:{alerts:n,search:a}});case 8:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),de=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={lastSync:"Unknown",lastUpdated:"Unknown",alertCounts:{},alerts:[],alertsForLinesStations:function(){return null},getAlertDetails:function(){return null},search:null,searchInfo:null,src:"",dst:""},n.loadQuerySearch=n.loadQuerySearch.bind(Object(f.a)(n)),n.search=n.search.bind(Object(f.a)(n)),window.onpopstate=n.loadQuerySearch,n}return Object(h.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this;ue().then(function(t){var n=t.domain.alerts;e.setState({lastUpdated:n.lastUpdated(),lastSync:n.lastSync(),alertCounts:n.alertCounts(),getAlertDetails:n.alertDetails,search:t.domain.search.search,alertsForLinesStations:n.alertsForLinesStations}),e.loadQuerySearch()})}},{key:"loadQuerySearch",value:function(){var e=new URL(window.location).searchParams,t=["src","dst"].map(function(t){return e.get(t)||""}),n=Object(l.a)(t,2),a=n[0],r=n[1];this.search(a,r)}},{key:"search",value:function(e,t){if(this.setState({src:e,dst:t}),""!==e&&""!==t){var n=this.state.search(e,t);this.setState({searchInfo:n});var a=this.state.alertsForLinesStations(n.lines,n.stations);this.setState({alerts:a})}else this.setState({searchInfo:null,alerts:[]})}},{key:"render",value:function(){return r.a.createElement("div",{className:"App"},r.a.createElement(E,{search:this.search,src:this.state.src,dst:this.state.dst}),r.a.createElement("div",{className:"content"},this.state.searchInfo?r.a.createElement(U,this.state.searchInfo):null,(this.state.alerts||[]).length>0?r.a.createElement(D,{alerts:this.state.alerts,getAlertDetails:this.state.getAlertDetails}):r.a.createElement(C,null)),r.a.createElement(j,{alerts:this.state.alertCounts,lastSync:this.state.lastSync,lastUpdate:this.state.lastUpdated}))}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(de,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}],[[17,1,2]]]);
//# sourceMappingURL=main.f98025bb.chunk.js.map