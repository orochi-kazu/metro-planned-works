(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,,,,,,,,,,,,function(e,t,n){},,function(e,t,n){e.exports=n.p+"static/media/logo.5901d734.svg"},,function(e,t,n){e.exports=n(33)},,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},,function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(14),i=n.n(s),c=(n(23),n(2)),l=n(5),o=n(6),u=n(9),d=n(7),h=n(3),m=n(10),f=n(8),p=(n(24),function(e){var t=e.initial,n=e.placeholder,a=e.onChange,s=e.extraClass;return r.a.createElement("input",{className:"search ".concat(s," bordered radius-m"),name:n.toLowerCase(),type:"text",value:t,placeholder:n,onChange:a})}),v=function(){return r.a.createElement("input",{className:"search end bordered radius-m",type:"submit",value:"Search"})},b=function(e){function t(e){var n;Object(l.a)(this,t);var a=(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).props,r=a.src,s=a.dst;return n.state={src:r,dst:s},n.handleChange=n.handleChange.bind(Object(h.a)(n)),n.handleSubmit=n.handleSubmit.bind(Object(h.a)(n)),n}return Object(m.a)(t,e),Object(o.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.src,n=e.dst;this.setState({src:t,dst:n})}},{key:"handleChange",value:function(e){var t=this;return function(n){t.setState(Object(f.a)({},e,n.target.value))}}},{key:"handleSubmit",value:function(e){e.preventDefault();var t=this.state,n=t.src,a=t.dst;window.history.pushState(null,"","?src=".concat(n,"&dst=").concat(a)),this.props.search(n,a)}},{key:"render",value:function(){return r.a.createElement("form",{className:"search",onSubmit:this.handleSubmit},r.a.createElement(p,{initial:this.state.src,placeholder:"Origin",onChange:this.handleChange("src"),extraClass:"start"}),r.a.createElement(p,{initial:this.state.dst,placeholder:"Destination",onChange:this.handleChange("dst"),extraClass:"middle"}),r.a.createElement(v,null))}}]),t}(a.Component),E=(n(13),function(e){var t=e.search,n=e.src,a=e.dst;return r.a.createElement("header",null,r.a.createElement("span",{className:"title"},r.a.createElement("span",{className:"icon"},"\u26a0")," Legible Works"),r.a.createElement(b,{search:t,src:n,dst:a}))}),g=(n(25),function(e){var t=e.count,n=e.type;return r.a.createElement("span",{className:"alert ".concat(n," bordered radius-m")},t||"?")}),y=function(e){var t=e.alerts;return r.a.createElement("div",null,r.a.createElement(g,{count:t.total,type:"total"})," alert details (",r.a.createElement(g,{count:t.ingested,type:"ingested"})," ingested,"," ",r.a.createElement(g,{count:t.pending,type:"pending"})," pending)")},j=(n(26),function(e){var t=e.lastUpdate;return r.a.createElement("div",null,"Last updated: ",r.a.createElement("span",{className:"updated"},t))}),O=(n(27),function(){return r.a.createElement("div",null,"Licensed under AGPL 3+. Source at ",r.a.createElement("a",{href:"https://github.com/orochi-kazu/metro-planned-works",target:"_blank",rel:"noopener"},"GitHub"))}),k=function(e){var t=e.alerts,n=e.lastUpdate;return r.a.createElement("footer",null,r.a.createElement(y,{alerts:t}),r.a.createElement(j,{lastUpdate:n}),r.a.createElement(O,null))},w=n(15),C=n.n(w),S=(n(28),function(){return r.a.createElement("div",{className:"empty-content"},r.a.createElement("img",{className:"logo",src:C.a,alt:"App logo: a caution sign"}))}),N=(n(29),function(){return r.a.createElement("div",{className:"outage uningested bordered radius-m"},"Pending")}),_=function(e){var t=e.area,n=e.from,a=e.to;return r.a.createElement("div",{className:"outage bordered radius-m"},r.a.createElement("div",{className:"outage-desc"},'"',t.desc,'"'),r.a.createElement("div",null,"Starts: ",n.iso),r.a.createElement("div",null,"Ends: ",a.iso))},A=function(e){e.id;var t=e.title,n=e.outages,a=e.link;return r.a.createElement("div",{className:"detail bordered radius-m"},r.a.createElement("div",{className:"alert-title"},r.a.createElement("span",null,t,r.a.createElement("span",{className:"nowrap"}," (",r.a.createElement("a",{href:a,target:"_blank",rel:"noopener"},"Metro"),")"))),r.a.createElement("div",null,n?n.map(function(e,t){return r.a.createElement(_,Object.assign({},e,{key:t}))}):r.a.createElement(N,null)))},L=(n(30),function(e){var t=e.id,n=(e.alerts,e.line),a=e.plannedWorks,s=e.getAlertDetails;if(!a)return null;var i=function(e){return function(t,n){var a=e(t);return a?r.a.createElement(A,Object.assign({},a,{title:n,key:t})):null}}(s);return r.a.createElement("div",{className:"alert-summary bordered radius-m"},r.a.createElement("div",{className:"alert-summary-title"},r.a.createElement("span",{className:"alert-summary-title"},n||"Unnamed line"),n?"":r.a.createElement("span",null,"\xa0(",t,")")),a.map(function(e){return i(e.id,e.title)}))}),D=function(e){var t=e.alerts,n=e.getAlertDetails;return t.map(function(e){return r.a.createElement(L,Object.assign({},e,{getAlertDetails:n,key:e.id}))})},U=function(e){var t=e.cityLoop,n=e.lines,a=e.stations,s=e.error;return s?r.a.createElement("div",{className:"results-intro"},r.a.createElement("div",null,"Something went wrong: ",s)):r.a.createElement("div",{className:"results-intro"},r.a.createElement("div",null,"City Loop? ",t?"Yes":"No"),r.a.createElement("div",null,"Lines: ",(n||[]).join(", ")),r.a.createElement("div",null,"Stations: ",(a||[]).join(", ")))},R=(n(31),n(1)),x=n.n(R),P=n(4),T=function(e){return{fetch:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){return fetch(e).then(function(e){return e.json()})})}},B=[],I={alerts:{},fetchDate:"",releaseDate:""},W={},Q=function(){var e=Object.keys(I.alerts),t=e.length,n=e.map(function(e){return I.alerts[e]}).filter(function(e){return e.outages}).length;return{total:t,ingested:n,pending:t-n}},z=function(){var e=Object(P.a)(x.a.mark(function e(t){var n;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.metroVarsClient,e.next=3,n.fetch();case 3:return W=e.sent,e.abrupt("return",{save:function(e){var t=e.healthboardAlerts,n=e.alertDetails;B=t,I=n},alerts:function(){return B},alertCounts:function(){return Q()},alertDetails:function(e){return I.alerts[e]},lastUpdated:function(){return I.releaseDate},stationsByLineName:function(){return W.network||{}},cityLoopStations:function(){return W.cityLoopStations}});case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),V=n(11),H=function(e){return Object.keys(e).map(function(t){return Object(V.a)({},e[t],{id:t})})},M=function(e){return{id:e.id,line:e.line_name,plannedWorks:e.planned_works_list}},G=function(){var e=Object(P.a)(x.a.mark(function e(t){var n,a,r,s,i,l,o,u,d;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.healthboardClient,a=t.detailsClient,r=t.store,e.next=3,Promise.all([n.fetch(),a.fetch()]);case 3:return s=e.sent,i=Object(c.a)(s,2),l=i[0],o=i[1],u=H(l).map(M),d=Object(V.a)({},o,{alerts:(h=o.alerts,Object.fromEntries(h.map(function(e){return[e.id,e]})))}),r.save({healthboardAlerts:u,alertDetails:d}),e.abrupt("return",{alerts:function(){return r.alerts()},alertCounts:function(){return r.alertCounts()},alertDetails:function(e){return r.alertDetails(e)},lastUpdated:function(){return r.lastUpdated()}});case 11:case"end":return e.stop()}var h},e)}));return function(t){return e.apply(this,arguments)}}(),J=n(16),Y=function(e,t){return e.reduce(function(e,n){return e||t.includes(n)},!1)},$=function(e,t){return e.length===t.length&&function(e,t){return e.map(function(e,n){return[e,t[n]]})}(e,t).reduce(function(e,t){var n=Object(c.a)(t,2),a=n[0],r=n[1];return e&&a===r},!0)},q=function(e,t,n){var a=function(e){return{lines:e}},r=function(e){return{error:e}};if(t===n)return r("no need to catch the train");var s=K(e,t),i=K(e,n);if(0===s.length&&0===i.length)return r("couldn't find either station");if(0===s.length)return r("couldn't find station \"".concat(t,'"'));if(0===i.length)return r("couldn't find station \"".concat(n,'"'));if($(s,i))return a(s);if(!Y(s,i))return r("these aren't on the same line");var l=s.length<i.length?[s,i]:[i,s],o=Object(c.a)(l,2),u=o[0];return function(e,t){var n=e.length<t.length,a=$(e,e.filter(function(e){return t.includes(e)}));return n&&a}(u,o[1])?a(u):r("oh no")},F=function(e,t,n){return e.includes(t)||e.includes(n)},K=function(e,t){return Object.entries(e).reduce(function(e,n){var a=Object(c.a)(n,2),r=a[0];return a[1].includes(t)?[].concat(Object(J.a)(e),[r]):e},[])},X=function(e,t,n,a){var r=e[t],s=r.indexOf(n),i=r.indexOf(a);if(s<0||i<0)return[];var l=s<i?[s,i]:[i,s],o=Object(c.a)(l,2),u=o[0],d=o[1],h=r.slice(u,d+1);return h[0]===n?h:h.reverse()},Z=function(e){var t=e.store;return{search:function(e,n){var a=F(t.cityLoopStations(),e,n),r=q(t.stationsByLineName(),e,n);if(r.error)return r;var s=r.lines,i=s[0];return{cityLoop:a,lines:s,stations:i?X(t.stationsByLineName(),i,e,n):[]}}}},ee=function(e){return Object({NODE_ENV:"production",PUBLIC_URL:"/metro-planned-works",REACT_APP_ALERT_DETAILS_URL:"https://orochi-kazu.github.io/metro-planned-works/alert_details.json",REACT_APP_HEALTHBOARD_ALERTS_URL:"https://orochi-kazu.github.io/metro-planned-works/healthboard_alerts.json",REACT_APP_METRO_VARIABLES_URL:"https://orochi-kazu.github.io/metro-planned-works/metro_variables.json"})["REACT_APP_".concat(e.toUpperCase(),"_URL")]},te=ee("healthboard_alerts"),ne=ee("alert_details"),ae=ee("metro_variables"),re=T(te),se=T(ne),ie=T(ae),ce=function(){var e=Object(P.a)(x.a.mark(function e(){var t,n,a;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z({metroVarsClient:ie});case 2:return t=e.sent,e.next=5,G({healthboardClient:re,detailsClient:se,store:t});case 5:return n=e.sent,a=Z({store:t}),e.abrupt("return",{domain:{alerts:n,search:a}});case 8:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),le=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={alertCounts:{},lastUpdated:"Unknown",alerts:[],getAlertDetails:function(){return null},search:null,searchInfo:null,src:"",dst:""},n.loadQuerySearch=n.loadQuerySearch.bind(Object(h.a)(n)),n.search=n.search.bind(Object(h.a)(n)),window.onpopstate=n.loadQuerySearch,n}return Object(m.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this;ce().then(function(t){var n=t.domain.alerts;e.setState({lastUpdated:n.lastUpdated(),alertCounts:n.alertCounts(),getAlertDetails:n.alertDetails,search:t.domain.search.search}),e.loadQuerySearch()})}},{key:"loadQuerySearch",value:function(){var e=new URL(window.location).searchParams,t=["src","dst"].map(function(t){return e.get(t)||""}),n=Object(c.a)(t,2),a=n[0],r=n[1];a&&r&&this.search(a,r)}},{key:"search",value:function(e,t){this.setState({src:e,dst:t});var n=this.state.search(e,t);this.setState({searchInfo:n})}},{key:"render",value:function(){return r.a.createElement("div",{className:"App"},r.a.createElement(E,{search:this.search,src:this.state.src,dst:this.state.dst}),r.a.createElement("div",{className:"content"},this.state.searchInfo?r.a.createElement(U,this.state.searchInfo):null,(this.state.alerts||[]).length>0?r.a.createElement(D,{alerts:this.state.alerts,getAlertDetails:this.state.getAlertDetails}):r.a.createElement(S,null)),r.a.createElement(k,{alerts:this.state.alertCounts,lastUpdate:this.state.lastUpdated}))}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(le,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}],[[17,1,2]]]);
//# sourceMappingURL=main.927d8e93.chunk.js.map