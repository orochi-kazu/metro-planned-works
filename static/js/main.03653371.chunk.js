(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,,,,,,,,,,,,function(e,t,n){},,function(e,t,n){e.exports=n.p+"static/media/logo.5901d734.svg"},,function(e,t,n){e.exports=n(33)},,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},,function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(14),s=n.n(i),o=(n(23),n(4)),c=n(1),l=n(6),u=n(7),d=n(9),h=n(8),m=n(2),f=n(10),p=(n(24),function(e){var t=e.initial,n=e.placeholder,a=e.onChange,i=e.extraClass;return r.a.createElement("input",{className:"search ".concat(i," bordered radius-m"),name:n.toLowerCase(),type:"text",value:t,placeholder:n,onChange:a})}),v=function(){return r.a.createElement("input",{className:"search end bordered radius-m",type:"submit",value:"Search"})},g=function(e){function t(e){var n;Object(l.a)(this,t),n=Object(d.a)(this,Object(h.a)(t).call(this,e));var a=new URL(window.location).searchParams,r=["src","dst"].map(function(e){return a.get(e)||""}),i=Object(c.a)(r,2),s=i[0],o=i[1];return n.state={src:s,dst:o},n.handleChange=n.handleChange.bind(Object(m.a)(n)),n.handleSubmit=n.handleSubmit.bind(Object(m.a)(n)),n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"handleChange",value:function(e){var t=this;return function(n){t.setState(Object(o.a)({},e,n.target.value))}}},{key:"handleSubmit",value:function(e){e.preventDefault();var t=this.state,n=t.src,a=t.dst;window.history.pushState(null,"","?src=".concat(n,"&dst=").concat(a)),this.props.search(n,a)}},{key:"render",value:function(){return r.a.createElement("form",{className:"search",onSubmit:this.handleSubmit},r.a.createElement(p,{initial:this.state.src,placeholder:"Origin",onChange:this.handleChange("src"),extraClass:"start"}),r.a.createElement(p,{initial:this.state.dst,placeholder:"Destination",onChange:this.handleChange("dst"),extraClass:"middle"}),r.a.createElement(v,null))}}]),t}(a.Component),E=(n(13),function(e){var t=e.search;return r.a.createElement("header",null,r.a.createElement("span",{className:"title"},r.a.createElement("span",{className:"icon"},"\u26a0")," Legible Works"),r.a.createElement(g,{search:t}))}),b=(n(25),function(e){var t=e.count,n=e.type;return r.a.createElement("span",{className:"alert ".concat(n," bordered radius-m")},t||"?")}),y=function(e){var t=e.alerts;return r.a.createElement("div",null,r.a.createElement(b,{count:t.total,type:"total"})," alert details (",r.a.createElement(b,{count:t.ingested,type:"ingested"})," ingested,"," ",r.a.createElement(b,{count:t.pending,type:"pending"})," pending)")},j=(n(26),function(e){var t=e.lastUpdate;return r.a.createElement("div",null,"Last updated: ",r.a.createElement("span",{className:"updated"},t))}),C=(n(27),function(){return r.a.createElement("div",null,"Licensed under AGPL 3+. Source at ",r.a.createElement("a",{href:"https://github.com/orochi-kazu/metro-planned-works",target:"_blank",rel:"noopener"},"GitHub"))}),O=function(e){var t=e.alerts,n=e.lastUpdate;return r.a.createElement("footer",null,r.a.createElement(y,{alerts:t}),r.a.createElement(j,{lastUpdate:n}),r.a.createElement(C,null))},S=n(15),w=n.n(S),k=(n(28),function(){return r.a.createElement("div",{className:"empty-content"},r.a.createElement("img",{className:"logo",src:w.a,alt:"App logo: a caution sign"}))}),L=(n(29),function(){return r.a.createElement("div",{className:"outage uningested bordered radius-m"},"Pending")}),_=function(e){var t=e.area,n=e.from,a=e.to;return r.a.createElement("div",{className:"outage bordered radius-m"},r.a.createElement("div",{className:"outage-desc"},'"',t.desc,'"'),r.a.createElement("div",null,"Starts: ",n.iso),r.a.createElement("div",null,"Ends: ",a.iso))},A=function(e){e.id;var t=e.title,n=e.outages,a=e.link;return r.a.createElement("div",{className:"detail bordered radius-m"},r.a.createElement("div",{className:"alert-title"},r.a.createElement("span",null,t,r.a.createElement("span",{className:"nowrap"}," (",r.a.createElement("a",{href:a,target:"_blank",rel:"noopener"},"Metro"),")"))),r.a.createElement("div",null,n?n.map(function(e,t){return r.a.createElement(_,Object.assign({},e,{key:t}))}):r.a.createElement(L,null)))},N=(n(30),function(e){var t=e.id,n=(e.alerts,e.line),a=e.plannedWorks,i=e.getAlertDetails;if(!a)return null;var s=function(e){return function(t,n){var a=e(t);return a?r.a.createElement(A,Object.assign({},a,{title:n,key:t})):null}}(i);return r.a.createElement("div",{className:"alert-summary bordered radius-m"},r.a.createElement("div",{className:"alert-summary-title"},r.a.createElement("span",{className:"alert-summary-title"},n||"Unnamed line"),n?"":r.a.createElement("span",null,"\xa0(",t,")")),a.map(function(e){return s(e.id,e.title)}))}),R=function(e){var t=e.alerts,n=e.getAlertDetails;return t.map(function(e){return r.a.createElement(N,Object.assign({},e,{getAlertDetails:n,key:e.id}))})},U=function(e){var t=e.cityLoop,n=e.lines,a=e.stations;return(n||{}).error?r.a.createElement("div",{className:"results-intro"},r.a.createElement("div",null,"Something went wrong: ",n.error)):r.a.createElement("div",{className:"results-intro"},r.a.createElement("div",null,"City Loop? ",t?"Yes":"No"),r.a.createElement("div",null,"Lines: ",((n||{}).lines||[]).join(", ")),r.a.createElement("div",null,"Stations: ",a))},D=(n(31),n(3)),F=n.n(D),P=n(5),x=function(e){return{fetch:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){return fetch(e).then(function(e){return e.json()})})}},T=[],B={alerts:{},fetchDate:"",releaseDate:""},Q={},W=function(){var e=Object.keys(B.alerts),t=e.length,n=e.map(function(e){return B.alerts[e]}).filter(function(e){return e.outages}).length;return{total:t,ingested:n,pending:t-n}},z=function(){var e=Object(P.a)(F.a.mark(function e(t){var n;return F.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.metroVarsClient,e.next=3,n.fetch();case 3:return Q=e.sent,e.abrupt("return",{save:function(e){var t=e.healthboardAlerts,n=e.alertDetails;T=t,B=n},alerts:function(){return T},alertCounts:function(){return W()},alertDetails:function(e){return B.alerts[e]},lastUpdated:function(){return B.releaseDate},stationsByLineName:function(){return Q.network||{}},cityLoopStations:function(){return Q.cityLoopStations}});case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),I=n(11),V=function(e){return Object.keys(e).map(function(t){return Object(I.a)({},e[t],{id:t})})},H=function(e){return{id:e.id,line:e.line_name,plannedWorks:e.planned_works_list}},G=function(){var e=Object(P.a)(F.a.mark(function e(t){var n,a,r,i,s,o,l,u,d;return F.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.healthboardClient,a=t.detailsClient,r=t.store,e.next=3,Promise.all([n.fetch(),a.fetch()]);case 3:return i=e.sent,s=Object(c.a)(i,2),o=s[0],l=s[1],u=V(o).map(H),d=Object(I.a)({},l,{alerts:(h=l.alerts,Object.fromEntries(h.map(function(e){return[e.id,e]})))}),r.save({healthboardAlerts:u,alertDetails:d}),e.abrupt("return",{alerts:function(){return r.alerts()},alertCounts:function(){return r.alertCounts()},alertDetails:function(e){return r.alertDetails(e)},lastUpdated:function(){return r.lastUpdated()}});case 11:case"end":return e.stop()}var h},e)}));return function(t){return e.apply(this,arguments)}}(),J=n(16),M=function(e,t){return e.reduce(function(e,n){return e||t.includes(n)},!1)},Y=function(e,t){return e.length===t.length&&function(e,t){return e.map(function(e,n){return[e,t[n]]})}(e,t).reduce(function(e,t){var n=Object(c.a)(t,2),a=n[0],r=n[1];return e&&a===r},!0)},$=function(e,t,n){var a=function(e){return{lines:e}},r=function(e){return{error:e}};if(t===n)return r("no need to catch the train");var i=K(e,t),s=K(e,n);if(0===i.length&&0===s.length)return r("couldn't find either station");if(0===i.length)return r("couldn't find station \"".concat(t,'"'));if(0===s.length)return r("couldn't find station \"".concat(n,'"'));if(Y(i,s))return a(i);if(!M(i,s))return r("these aren't on the same line");var o=i.length<s.length?[i,s]:[s,i],l=Object(c.a)(o,2),u=l[0];return function(e,t){var n=e.length<t.length,a=Y(e,e.filter(function(e){return t.includes(e)}));return n&&a}(u,l[1])?a(u):r("oh no")},q=function(e,t,n){return e.includes(t)||e.includes(n)},K=function(e,t){return Object.entries(e).reduce(function(e,n){var a=Object(c.a)(n,2),r=a[0];return a[1].includes(t)?[].concat(Object(J.a)(e),[r]):e},[])},X={intersectsCityLoop:[],linesForStations:[],stationRangeForStations:[]},Z=function(e){var t=e.store;return{registerFor:{intersectsCityLoop:function(e){X.intersectsCityLoop.push(e)},linesForStations:function(e){X.linesForStations.push(e)},stationRangeForStations:function(e){X.stationRangeForStations.push(e)}},intersectsCityLoop:function(e,n){var a=q(t.cityLoopStations(),e,n);X.intersectsCityLoop.forEach(function(e){e(a)})},linesForStations:function(e,n){var a=$(t.stationsByLineName(),e,n);X.linesForStations.forEach(function(e){e(a)})},stationRangeForStations:function(e,t){}}},ee=function(e){return Object({NODE_ENV:"production",PUBLIC_URL:"/metro-planned-works",REACT_APP_ALERT_DETAILS_URL:"https://orochi-kazu.github.io/metro-planned-works/alert_details.json",REACT_APP_HEALTHBOARD_ALERTS_URL:"https://orochi-kazu.github.io/metro-planned-works/healthboard_alerts.json",REACT_APP_METRO_VARIABLES_URL:"https://orochi-kazu.github.io/metro-planned-works/metro_variables.json"})["REACT_APP_".concat(e.toUpperCase(),"_URL")]},te=ee("healthboard_alerts"),ne=ee("alert_details"),ae=ee("metro_variables"),re=x(te),ie=x(ne),se=x(ae),oe=function(){var e=Object(P.a)(F.a.mark(function e(){var t,n,a;return F.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z({metroVarsClient:se});case 2:return t=e.sent,e.next=5,G({healthboardClient:re,detailsClient:ie,store:t});case 5:return n=e.sent,a=Z({store:t}),e.abrupt("return",{domain:{alerts:n,search:a}});case 8:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),ce=null,le=["intersectsCityLoop","linesForStations","stationRangeForStations"],ue=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(d.a)(this,Object(h.a)(t).call(this,e))).state={alertCounts:{},lastUpdated:"Unknown",alerts:[],getAlertDetails:function(){return null},search:null},n.receiveResult=n.receiveResult.bind(Object(m.a)(n)),n.search=n.search.bind(Object(m.a)(n)),n.loadQuerySearch=n.loadQuerySearch.bind(Object(m.a)(n)),oe().then(function(e){le.forEach(function(t){e.domain.search.registerFor[t](n.receiveResult(t))}),ce=e.domain.alerts,n.setState({lastUpdated:ce.lastUpdated(),alertCounts:ce.alertCounts(),getAlertDetails:ce.alertDetails,search:e.domain.search}),n.loadQuerySearch()}),window.onpopstate=n.loadQuerySearch,n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"loadQuerySearch",value:function(){var e=new URL(window.location).searchParams,t=["src","dst"].map(function(t){return e.get(t)||""}),n=Object(c.a)(t,2),a=n[0],r=n[1];a&&r&&this.search(a,r)}},{key:"receiveResult",value:function(e){var t=this;return function(n){t.setState(Object(o.a)({},e,n))}}},{key:"search",value:function(e,t){var n=this;le.forEach(function(a){n.state.search[a](e,t)})}},{key:"render",value:function(){return r.a.createElement("div",{className:"App"},r.a.createElement(E,{search:this.search}),r.a.createElement("div",{className:"content"},this.state.linesForStations?r.a.createElement(U,{cityLoop:this.state.intersectsCityLoop,lines:this.state.linesForStations,stations:this.state.stationRangeForStations}):null,(this.state.alerts||[]).length>0?r.a.createElement(R,{alerts:this.state.alerts,getAlertDetails:this.state.getAlertDetails}):r.a.createElement(k,null)),r.a.createElement(O,{alerts:this.state.alertCounts,lastUpdate:this.state.lastUpdated}))}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(ue,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}],[[17,1,2]]]);
//# sourceMappingURL=main.03653371.chunk.js.map